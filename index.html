<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pri‚Äôs Planner ‚Äî Projects ‚Üí Weekly ‚Üí Calendar</title>
<style>
  :root{ --bg:#f6f9fe; --card:#ffffff; --ink:#1d2433; --muted:#5d6b85; --brand:#5a7cf7; --accent:#00b894; --warn:#ff8a65; --shadow:0 10px 25px rgba(25,50,150,.08); --radius:16px; }
  *{box-sizing:border-box} html,body{height:100%}
  body{ margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; color:var(--ink);
        background:linear-gradient(135deg,#f0f5ff,#f8fbff 35%,#eefaff 70%,#f6f9fe);}
  header{ background: linear-gradient(90deg,#5668ff,#5ac8fa);
          color:white; padding:26px 18px 20px; position:sticky; top:0; z-index:5; box-shadow:var(--shadow);}
  .wrap{max-width:1100px;margin:0 auto}
  .title{display:flex; gap:14px; align-items:center; flex-wrap:wrap}
  .title h1{margin:0; font-size:clamp(22px,4vw,28px)}
  .pill{padding:6px 10px; border-radius:999px; background:#eef7ff; color:#173; font-weight:600; font-size:12px}
  .row{display:grid; gap:18px; padding:18px; grid-template-columns:1fr}
  @media (min-width:980px){.row{grid-template-columns:1.2fr 1fr}}
  .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px}
  .muted{color:var(--muted)}
  .toolbar{display:flex; gap:8px; flex-wrap:wrap}
  button{border:0; border-radius:12px; padding:10px 12px; cursor:pointer; font-weight:600; background:var(--brand); color:#fff; box-shadow:0 5px 14px rgba(90,124,247,.25)}
  .btn-ghost{background:#eef2ff; color:#3b4dff; box-shadow:none}
  .btn-accent{background:var(--accent)} .btn-warn{background:var(--warn)}
  input,textarea,select{width:100%; padding:10px 12px; border-radius:12px; border:1px solid #e6ebf5; background:#fbfcff; outline:none; font-size:14px}
  .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  .grid-3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px}
  .list{display:grid; gap:10px; margin:10px 0 0}
  .item{background:#f9fbff; border:1px solid #edf2ff; border-radius:14px; padding:12px; display:grid; gap:6px}
  .topline{display:flex; align-items:center; gap:8px; justify-content:space-between}
  .badge{padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700; color:#1b3; background:linear-gradient(90deg,#e9fff7,#f2fffc); border:1px solid #d9fff3}
  .meta{font-size:12px; color:var(--muted); display:flex; gap:10px; flex-wrap:wrap}
  .actions{display:flex; gap:8px; flex-wrap:wrap}
  .kpis{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
  .kpi{background:#f7fafc; border:1px solid #eef3ff; border-radius:14px; padding:12px; text-align:center}
  .kpi strong{font-size:18px; display:block}
  .footer-note{font-size:12px; color:var(--muted); margin-top:8px}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">
        <h1>Pri‚Äôs Planner</h1>
        <span class="pill">Monthly projects ‚Üí Weekly priorities ‚Üí Calendar</span>
      </div>
      <p class="muted">Your planner synced with Airtable ‚òÅÔ∏è</p>
      <div class="toolbar" style="margin-top:10px">
        <button class="btn-accent" onclick="document.getElementById('p-name').focus()">Add Project</button>
        <button class="btn-ghost" onclick="cloudLoad()">‚ü≥ Sync Now</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="row">
      <section class="card">
        <h2>‚ûï Add Project</h2>
        <div class="grid-2">
          <input id="p-name" placeholder="Project name"/>
          <input id="p-deadline" type="date" />
        </div>
        <div class="grid-3" style="margin-top:10px">
          <select id="p-stage"><option>Ideation</option><option selected>In Progress</option><option>Review</option><option>Final</option></select>
          <select id="p-priority"><option>P0</option><option selected>P1</option><option>P2</option></select>
          <input id="p-link" placeholder="Link (Drive/Figma/Doc)" />
        </div>
        <textarea id="p-notes" rows="3" style="margin-top:10px" placeholder="Notes (short)"></textarea>
        <div class="toolbar" style="margin-top:10px">
          <button onclick="addProject()">Add</button>
        </div>

        <div style="margin-top:16px">
          <div class="kpis">
            <div class="kpi"><strong id="kpi-total">0</strong><span class="muted">Total projects</span></div>
            <div class="kpi"><strong id="kpi-weekly">0</strong><span class="muted">Weekly items</span></div>
            <div class="kpi"><strong id="kpi-due">0</strong><span class="muted">Due this week</span></div>
          </div>
        </div>

        <h2 style="margin-top:16px">üìÅ Projects</h2>
        <div id="projects" class="list"></div>
      </section>

      <section class="card">
        <h2>üìå This Week‚Äôs Priorities</h2>
        <div class="toolbar" style="margin-bottom:10px">
          <button class="btn-accent" onclick="quickAddWeekly()">Quick Add</button>
          <button class="btn-ghost" onclick="clearDone()">Clear Done</button>
        </div>
        <div id="weekly" class="list"></div>
      </section>
    </div>
  </main>

<script>
/* ===== Airtable Config ===== */
const AIRTABLE_TOKEN = "patyXlyESkLpAuBsY.ffaf735e412161a668e96fb43bc76ebb18f4457d3b9ff2b62fca59dc42adf4c5";
const AIRTABLE_BASE  = "appuxirqdTb4YIqur";
const AIRTABLE_TABLE = "Tasks";

/* ===== Local state ===== */
const storeKey = "pri_planner_v3";
let db = load() || { projects: [], weekly: [] };

function uid(){ return Math.random().toString(36).slice(2, 9); }
function save(){ localStorage.setItem(storeKey, JSON.stringify(db)); render(); cloudSave(); }
function load(){ try{ return JSON.parse(localStorage.getItem(storeKey)); }catch(e){ return null; } }
function fmtDate(d){ if(!d) return "No date"; try{ return new Date(d).toLocaleDateString(); }catch(e){return d;} }
function within7Days(dateStr){ if(!dateStr) return false; const now=new Date(); const d=new Date(dateStr); const diff=(d-now)/(1000*60*60*24); return diff<=7 && diff>=-1; }

/* ===== Render UI ===== */
function render(){
  document.getElementById("kpi-total").textContent = db.projects.length;
  document.getElementById("kpi-weekly").textContent = db.weekly.length;
  document.getElementById("kpi-due").textContent = db.weekly.filter(w => within7Days(w.due) && !w.done).length;

  const projEl = document.getElementById("projects");
  projEl.innerHTML = "";
  db.projects.forEach(p=>{
    const item = document.createElement("div");
    item.className="item";
    item.innerHTML = `
      <div class="topline"><strong>${p.name}</strong><span class="badge">${p.priority}</span></div>
      <div class="meta"><span>Stage: <b>${p.stage}</b></span><span>Deadline: <b>${fmtDate(p.deadline)}</b></span></div>
      ${p.notes? `<div class="muted">${p.notes}</div>`:""}
      <div class="actions">
        <button class="btn-accent" onclick='addToWeekly("${p.id}")'>Add to Weekly</button>
        <button class="btn-ghost" onclick='deleteProject("${p.id}")'>Delete</button>
      </div>`;
    projEl.appendChild(item);
  });

  const wEl = document.getElementById("weekly");
  wEl.innerHTML="";
  db.weekly.forEach(w=>{
    const item=document.createElement("div");
    item.className="item"; item.style.opacity=w.done?.6:1;
    item.innerHTML=`
      <div class="topline"><strong>${w.title}</strong>${within7Days(w.due)?'<span class="badge">Due soon</span>':""}</div>
      <div class="meta"><span>Due: <b>${fmtDate(w.due)}</b></span></div>
      <div class="actions">
        <button class="btn-ghost" onclick='toggleDone("${w.id}")'>${w.done?"Mark Undone":"Mark Done"}</button>
        <button class="btn-warn" onclick='deleteWeekly("${w.id}")'>Delete</button>
      </div>`;
    wEl.appendChild(item);
  });
}

/* ===== CRUD ===== */
function addProject(){
  const p={ id:uid(), name:val("p-name"), deadline:val("p-deadline"), stage:val("p-stage"), priority:val("p-priority"), notes:val("p-notes"), link:val("p-link") };
  if(!p.name) return alert("Project name required");
  db.projects.push(p); clearInputs("p-name","p-deadline","p-notes","p-link"); save();
}
function deleteProject(id){ db.projects=db.projects.filter(p=>p.id!==id); save(); }
function addToWeekly(id){ const p=db.projects.find(x=>x.id===id); if(!p)return; db.weekly.push({id:uid(), title:p.name, due:p.deadline, done:false}); save(); }
function quickAddWeekly(){ const title=prompt("Weekly task title"); if(!title)return; db.weekly.push({id:uid(), title, due:new Date().toISOString().slice(0,10), done:false}); save(); }
function toggleDone(id){ const w=db.weekly.find(x=>x.id===id); if(w){ w.done=!w.done; save(); } }
function deleteWeekly(id){ db.weekly=db.weekly.filter(w=>w.id!==id); save(); }
function clearDone(){ db.weekly=db.weekly.filter(w=>!w.done); save(); }

/* ===== Airtable Sync ===== */
async function cloudSave(){
  // Clear table (simplest way: re-upload all tasks)
  for(const proj of db.projects){
    await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE}/${AIRTABLE_TABLE}`,{
      method:"POST",
      headers:{Authorization:`Bearer ${AIRTABLE_TOKEN}`,"Content-Type":"application/json"},
      body:JSON.stringify({fields:proj})
    });
  }
}
async function cloudLoad(){
  const res=await fetch(`https://api.airtable.com/v0/${AIRTABLE_BASE}/${AIRTABLE_TABLE}`,{
    headers:{Authorization:`Bearer ${AIRTABLE_TOKEN}`}
  });
  const data=await res.json();
  db.projects=data.records.map(r=>r.fields);
  save();
}

/* ===== Helpers ===== */
function val(id){return document.getElementById(id).value.trim();}
function clearInputs(...ids){ids.forEach(i=>document.getElementById(i).value="");}

render();
</script>
</body>
</html>
